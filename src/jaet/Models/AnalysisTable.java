package jaet.Models;

import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class AnalysisTable {
    private ArrayList<String> production = new ArrayList<>();

    private String table [][] = {
            {" ","archivio","funzione","init","#","ALPHANUMERICS","^[a-zA-Z]$","_","^(=)$","^(\\+|\\-|\\*|/|\\^)$","while","for","enterokay","stamp","\"","true|false","^[0-9]$",",","if","else","scegliere","\'","dafault","break","return","^(<|>|<=|>=|==|!=)$","^(\\+\\+|\\-\\-)$","\\}",";","\\{","\\)","\\("},
            {"<DA>","archivio <V> { <DM> <CA> }"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<CA>"," ","<DFUN> <CA>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","ε"," "," "," "," "},
            {"<DM>"," "," ","init main ( current_ ) { <CUR> }"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<DCM>"," "," "," ","# <RCM>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<RCM>"," "," "," ","ε"," ","ε","ε"," "," ","ε","ε","ε","ε"," "," "," "," "," "," ","ε"," "," "," "," "," "," "," "," ","{ <C> }"," "," "},
            {"<DV>"," "," "," "," "," ","<V> <RDV>","<V> <RDV>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<RDV>"," "," "," "," "," "," "," ","= S"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","<CONT>"," "," "," "," "," "},
            {"<DW>"," "," "," "," "," "," "," "," "," ","while := <E> { <CUR> <RRET> }"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<DF>"," "," "," "," "," "," "," "," "," "," ","for := <EF> { <CUR> <RRET> }"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<EF>"," "," "," "," "," ","<DV> ; <E> ; <V> <CONT>","<DV> ; <E> ; <V> <CONT>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<DE>"," "," "," "," "," "," "," "," "," "," "," ","enterokay <V>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<DS>"," "," "," "," "," "," "," "," "," "," "," "," ","stamp ( <CONC> )"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<CONC>"," "," "," "," "," "," ","<S> <RC>"," "," "," "," "," "," ","<S> <RC>","<S> <RC>","<S> <RC>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<RC>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ",", <S> <RC>"," "," "," "," "," "," "," "," "," "," "," "," ","ε"," "},
            {"<DIF>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","if := <EX> { <CUR> <RREST> } <RIF>"," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<RIF>"," "," "," ","ε"," ","ε","ε"," "," ","ε","ε","ε","ε"," "," "," "," ","ε","else <RE>","ε"," "," "," "," "," "," "," "," "," "," "," "},
            {"<RE>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","<DIF>"," "," "," "," "," "," "," "," ","{ <CUR> }"," "," "," "," "},
            {"<DFUN>"," ","funzione <V> ( <P> ) { <CUR> }"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<P>"," "," "," "," "," ","<V> <RP>","<V> <RP> "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<RP>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ",", <V> <RP>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<DSC>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","scegliere := <V> { <OP> }"," "," "," "," "," "," "," "," "," ","ε"," "},
            {"<OP>"," "," "," "," "," "," "," "," "," "," "," "," "," ","<TC> <ROPC>"," ","<TC> <RO>"," "," "," "," ","<TC> <ROPC>"," "," "," "," "," "," "," "," "," "," "},
            {"<ROPC>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","default { <CUR> }"," "," "," ","ε"," "," "," "," "},
            {"<TD>"," "," "," "," "," "," "," "," "," "," "," "," "," ","\" <C> \""," ","<N>"," "," "," "," ","\' <L> \'"," "," "," "," "," "," "," "," "," "," "},
            {"<TC>"," "," "," "," "," "," "," "," "," "," "," "," "," ","<TD> { <CUR> } <RTC> <CT>"," ","<TD> { <CUR> } <RTC> <CT>"," "," "," "," ","<TD> { <CUR> } <RTC> <CT>"," "," "," "," "," "," "," "," "," "," "},
            {"<RTC>"," "," "," "," "," "," "," "," "," "," "," "," "," ","ε"," ","ε"," "," "," "," ","ε"," ","break"," "," "," "," "," "," "," "," "},
            {"<CT>"," "," "," "," "," "," "," "," "," "," "," "," "," ","<TC> <CT>"," ","<TC> <CT>"," "," "," "," ","<TC> <CT>"," "," "," "," "," "," "," ","ε"," "," "},
            {"<DR>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","return <R>"," "," "," "," "," "," "," "},
            {"<R>"," "," "," "," "," ","<S> <RR>"," "," "," "," "," "," "," ","<S> <RR>","<S> <RR>","<S> <RR>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<RR>"," "," "," "," "," "," "," ", " "," ", " "," ", " "," "," "," ", " ",", <S> <RR>"," "," "," "," "," "," "," "," "," ","ε"," "," "," "," "},
            {"<V>"," "," "," "," "," ","<L> <RV>","_ <RV>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<LLF>"," "," "," "," "," ","<V> ( <P> )","<V> ( <P> )"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<C>"," "," "," "," ","ALPHANUMERICS"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<CUR>"," "," "," ","<DCM> <CUR>"," ","<DV> <CUR>","<DV> <CUR>"," "," ","<DW> <CUR>","<DF> <CUR>","<DE> <CUR>","<DS> <CUR>"," "," "," "," ","<DIF> <CUR>"," ","<DSC> <CUR>"," "," "," ","ε"," "," ","ε"," "," "," "," "},
            {"<RV>"," "," "," "," "," ","<L> <RV>","_ <RV>","ε"," "," "," "," "," "," "," ","<D> <RV>","ε"," "," "," "," "," "," "," "," ","ε"," "," ","ε","ε","ε"},
            {"<EX>"," "," "," "," "," ","<S> <OR> <S>"," "," "," "," "," "," "," ","<S> <OR> <S>","<S> <OR> <S>","<S> <OR> <S>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<S>"," "," "," "," "," ","<V>"," "," "," "," "," "," "," ","\" <C> \"","<B>","<O>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<OPR>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","<N> <RO>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<RO>"," "," "," ","ε"," ","ε","ε","ε","<O> <N> <RO>","ε","ε","ε","ε"," "," "," "," ","ε"," "," "," "," "," "," ","ε"," ","ε","ε","ε","ε"," "},
            {"<N>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","<D> <DF>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<CF>"," "," "," ","ε"," ","ε","ε","ε","ε","ε","ε","ε","ε"," "," ","<D> <DF>","ε"," "," "," "," "," "," "," ","ε"," ","ε","ε","ε","ε"," "},
            {"<RRET>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","<DR>"," "," ","ε"," "," "," "," "},
            {"<OR>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","^(<|>|<=|>=|=|==|!=)$"," "," "," "," "," "," "},
            {"<B>"," "," "," "," "," "," "," "," "," "," "," "," "," "," ","true|false"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<O>"," "," "," "," "," "," "," "," ","^(\\+|\\-|\\*|/|\\^)$"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<D>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","^[0-9]$"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<L>"," "," "," "," "," ","^[a-zA-Z]$"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "},
            {"<CONT>"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","^(\\+\\+|\\-\\-)$"," "," "," "," "," "},

    };

    public boolean existDerivation(String notTerminal, String terminal){
        production.clear();
        String[] words;
        int row=0, column=0;
        String[] columns;
        String derivation;
        for (int i = 0; i < table.length; i++) {
            columns = table[i];
            for(int j=0; j<columns.length;j++){
                if(table[i][0].equals(notTerminal) && isValid(terminal, table[0][j])){
                    if(table[i][0].equals("<L>") || table[i][0].equals("<O>") || table[i][0].equals("<B>") || table[i][0].equals("<N>") || table[i][0].equals("<OR>") || table[i][0].equals("<CONT>")){
                        table[i][j] = terminal;
                    }
                    row = i;
                    column = j;
                    break;
                }
            }
        }
        if(row == 0 || column==0){
            row=0;
            column=0;
        }
        derivation = table[row][column];
        if(!derivation.equals(" ")) {
            if(!derivation.equals("ε")){
                words = derivation.split(" ");
                for (int i = 0; i < words.length; i++) {
                    String word = words[i];
                    production.add(word);
                }
            }
            return true;
        }
        return false;

    }

    public ArrayList<String> getProduction() {
        return production;
    }

    public boolean isValid(String input, String regex){
        Pattern pattern;
        Matcher match;
        pattern = Pattern.compile(regex);
        match = pattern.matcher(input);
        return match.find();
    }

    public boolean isNotTerminal(String notTerminal){

        for (int i = 0; i < table.length; i++) {
            if(table[i][0].equals(notTerminal))
                return true;
        }
        return false;
    }

    public void separateDerivation(String derivation) {
        System.out.println(derivation);
        String[] words;
        words = derivation.split(" ");
        for (int i = 0; i < words.length; i++) {
            String word = words[i];
            if (word.equals("")) ;
            else if (word.equals(" ")) ;
            else {
                if (isCorrect(word)) {
                    production.add(word);
                } else {
                    char[] letras = word.toCharArray();
                    for (int j = 0; j < letras.length; j++) {
                        production.add(String.valueOf(letras[j]));
                    }
                }
            }
        }
    }

    public boolean isCorrect(String word){
        System.out.println(word);
        String[] columns;
        for(int i=0;i<table.length;i++){
            columns = table[i];
            for(int j=0; j<columns.length;j++){
                if(word.equals(table[0][j]) || word.equals(table[i][0])){
                    return true;
                }
            }
        }
        return false;
    }

}
